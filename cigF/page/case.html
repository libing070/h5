<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1, minimum-scale=1">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="./../css/swiper.min.css">
    <link rel="stylesheet" href="./../css/layer.css">
    <link rel="stylesheet" href="./../css/base.css">
    <link rel="stylesheet" href="./../css/base_pc.css">
    <link rel="stylesheet" href="./../css/page/case.css">
    <title>CIG新意互动</title>
</head>

<body>
    <div class="container case">
        <div class="caseSwiper swiper-container">
            <div class="swiper-wrapper">
                <div class="swiper-slide">
                    <img src="./../images/page/case_banner1.jpg" alt="">
                </div>
            </div>
        </div>
        <div class="case_cont">
            <div class="case_nav">
                <ul>
                    <li>
                        <a href="javascript:;" type="24">整合营销</a>
                    </li>
                    <li>
                        <a href="javascript:;" type="25">内容营销</a>
                    </li>
                    <li>
                        <a href="javascript:;" type="26">社会化与用户营销</a>
                    </li>
                    <li>
                        <a href="javascript:;" type="27">大数据营销</a>
                    </li>
                    <li>
                        <a href="javascript:;" type="28">视频营销</a>
                    </li>
                    <li>
                        <a href="javascript:;" type="29">技术营销</a>
                    </li>
                    <li>
                        <a href="javascript:;" type="30">互动体验</a>
                    </li>
                    <li>
                        <a href="javascript:;" type="31">媒介营销</a>
                    </li>
                </ul>
            </div>
            <div class="caseList">

            </div>
            <div class="case_loodMore" hasmore="1" pageindex="1">
                <img style="cursor: pointer" src="./../images/page/loadMoreIcon.png" alt="">
                <p style="width: 2rem;cursor: pointer;margin: auto">加载更多</p>
            </div>
        </div>
    </div>
    <script src="./../js/jquery-1.11.2.min.js"></script>
    <script src="./../js/jquery.cookie.js"></script>
    <script src="./../js/anime.min.js"></script>
    <script src="./../js/layer.js"></script>
    <script src="./../js/rem.js"></script>
    <script src="./../js/swiper.min.js"></script>
    <script src="./../js/md5.js"></script>
    <!-- <script src="./../js/swiperInit.js"></script> -->
    <script src="./../js/common.js"></script>
    <script src="./../js/page/page.js"></script>
    <!-- <script src="./../js/interFace.js"></script> -->
    <script src="./../js/baiduTemplate.js"></script>
    <script id="navTemplate" type="text/template">

            <% for(var i=0; i< list.length; i++){%>
            <div class="list">
                    <a href="./detail.html?caseId=<%=list[i].id%>">
                <div class="imgBox">
                        <%if(list[i].multimediaType==1){%>
                            <img src="<%=list[i].url %>" alt="">
                            <%}else{%>
                                <video src="<%=list[i].url %>"></video>
                            <%}%>
                    <div class="teamActive">
                        <div></div>
                    </div>
                </div>
                <div class="list_txt">
                    <div class="sj-top"></div>
                    <p class="txt_1">2019/8/20</p>
                    <p class="txt_2"><%=list[i].serviceUser %></p>
                    <p class="txt_2"><%=list[i].name %></p>
                    <p class="txt_3 mg-top"><%=list[i].content %></p>      
                </div>
            </a>
            </div>
            <%}%>
    
    </script>
    <script>
        $(function () {
            // console.log(getUrlParam('index'))
            var urlParame = getUrlParam('index');
            if (urlParame) {
                for (let i = 1; i <= $('.case_nav ul li').length; i++) {
                    if (i == urlParame) {
                        var ele = $('.case_nav ul li')[(i - 1)];
                        $(ele).find('a').addClass('act');
                        var type = $(ele).find('a').attr('type');
                        getList(1, type);
                    }
                }
            } else {
                $($('.case_nav ul li a')[0]).addClass('act');
                getList(1, 24);
            }

            var caseSwiper = new Swiper('.caseSwiper,swiper-container', {
                loop: false,
                observer: true, //修改swiper自己或子元素时，自动初始化swiper
                observeParents: true, //修改swiper的父元素时，自动初始化swiper
            });
            $('.case_nav ul li').on('click', function () {
                $('.case_nav ul li a').removeClass('act');
                $(this).find('a').addClass('act');
                var type = $(this).find('a').attr('type');
                $(".case_loodMore").attr("pageIndex",'1').attr("hasmore","1");
                $('.case_loodMore').find('p').html("加载更多");
                getList(1, type);
            });
            ///api/Case/GetPagingList (Portal_003)获取案例分页列表
            $('.case_loodMore').on('click', function () {
                if( $('.case_loodMore').attr("hasmore")==1){
                    $(this).find('img').addClass('loadRotate');
                    var index = $(this).attr('pageIndex');
                    var type = $('.case_nav .act').attr('type');
                    index++;
                    $(this).attr('pageIndex', index);
                    getList($(this).attr('pageIndex'), type);
                }
            });
            function getList(index, type) {
                $.request('/api/Case/GetPagingList', {
                    pageIndex: index || 1,
                    pageSize: 10,
                    timestamp: ts(),
                    type: type,
                    sign: createSign({
                        "pageIndex": index || 1,
                        "pageSize": 10,
                        timestamp: ts(),
                        type: type
                    })
                },
                    function (res) {
                    if(res.data.caseList.length==0){
                        $('.case_loodMore').attr("hasmore","0");
                        $('.case_loodMore').find('img').removeClass('loadRotate');
                        $('.case_loodMore').find('p').html("没有更多了");
                        return;
                    }
                        // console.log(res);
                        var data = {
                            'list': res.data.caseList
                        };
                        var bt = baidu.template;
                        var html = bt('navTemplate', data);
                        // console.log(html)
                        if ( $('.case_loodMore').attr("pageIndex")!=1) {
                            $('.caseList').append(html);
                        } else {
                            $('.caseList').html(html);
                        }
                        $('.case_loodMore').find('img').removeClass('loadRotate');
                    }
                );
            }

        });

    </script>
</body>

</html>