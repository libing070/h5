<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1, minimum-scale=1">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="./../css/swiper.min.css">
    <link rel="stylesheet" href="./../css/layer.css">
    <link rel="stylesheet" href="./../css/base.css">
    <link rel="stylesheet" href="./../css/base_pc.css">
    <link rel="stylesheet" href="./../css/page/case.css">
    <title>CIG新意互动</title>
</head>

<body>
    <div class="container case">
        <div class="caseSwiper swiper-container">
            <div class="swiper-wrapper">
                <div class="swiper-slide">
                    <img src="./../images/page/case_banner1.jpg" alt="">
                </div>
            </div>
        </div>
        <div class="case_cont">
            <div class="case_nav">
                <ul>
                    <li>
                        <a href="javascript:;" type="20">新意动态</a>
                    </li>
                    <li>
                        <a href="javascript:;" type="21">新意荣誉</a>
                    </li>
                    <li>
                        <a href="javascript:;" type="22">新意观点</a>
                    </li>
                    <li>
                        <a href="javascript:;" type="23">行业观察</a>
                    </li>
                </ul>
            </div>
            <div class="news_cont">
                <ul>
                    <!-- <li>
                        <div class="news_imgBox">
                            <img src="./../images/page/honor_prize_1.jpg" alt="">
                        </div>
                        <p class="news_p1">侧面看戛纳，除了创意这里还有什么</p>
                        <p class="news_p2">作为戛纳狮子节的周边活动，“华人CMO大师班”赢得了越来越多国内顶级营销人的青睐。“华人CMO大师班”是一项面向华人营销领袖的培训交流活动。</p>
                    </li> -->
                </ul>
            </div>
            <div class="case_loodMore" hasmore="1" pageIndex="1">
                <img style="cursor: pointer" src="./../images/page/loadMoreIcon.png" alt="">
                <p style="width: 2rem;cursor: pointer;margin: auto">加载更多</p>
            </div>
        </div>
    </div>
    <script src="./../js/jquery-1.11.2.min.js"></script>
    <script src="./../js/jquery.cookie.js"></script>
    <script src="./../js/anime.min.js"></script>
    <script src="./../js/layer.js"></script>
    <script src="./../js/rem.js"></script>
    <script src="./../js/swiper.min.js"></script>
    <script src="./../js/md5.js"></script>
    <!-- <script src="./../js/swiperInit.js"></script> -->
    <script src="./../js/common.js"></script>
    <script src="./../js/page/page.js"></script>
    <script src="./../js/baiduTemplate.js"></script>
    <script id="navTemplate" type="text/template">

    <ul>
        <% for(var i=0; i< list.length; i++){%>
        <li>
            <a href="./detail.html?newsId=<%=list[i].id%>">
                    <div class="news_imgBox">
                            <%if(list[i].multimediaType==1){%>
                            <img src="<%=list[i].picUrl %>" alt="">
                            <%}else{%>
                                <video src="<%=list[i].picUrl %>"></video>
                            <%}%>
                            <div class="teamActive">
                                <div></div>
                            </div>
                        </div>
                        <p class="news_p1"><%=list[i].title%></p>
                        <p class="news_p2"><%=list[i].summary%></p>
            </a>
        </li>
        <%}%>
    </ul>
       
  
    </script>
    <script>
        $(function () {
            var urlParame = getUrlParam('index');
            if (urlParame) {
                for (let i = 1; i <= $('.case_nav ul li').length; i++) {
                    if (i == urlParame) {
                        var ele = $('.case_nav ul li')[(i - 1)];
                        $(ele).find('a').addClass('act');
                        var type = $(ele).find('a').attr('type');
                        console.log(ele, i)
                        loadData(1, type);
                    }
                }
            } else {
                $($('.case_nav ul li a')[0]).addClass('act');
                loadData(1, 20);
            }

            var caseSwiper = new Swiper('.caseSwiper,swiper-container', {
                loop: false,
                observer: true, //修改swiper自己或子元素时，自动初始化swiper
                observeParents: true, //修改swiper的父元素时，自动初始化swiper
            });
            $('.case_nav ul li').on('click', function () {
                $('.case_nav ul li a').removeClass('act');
                $(this).find('a').addClass('act');
                var type = $(this).find('a').attr('type');
                $(".case_loodMore").attr("pageIndex",'1').attr("hasmore","1");
                $('.case_loodMore').find('p').html("加载更多");
                loadData(1, type);
            });
            ///api/News/GetRecommendNews(Portal_005)获取新闻推荐
            $('.case_loodMore').on('click', function () {
                if( $('.case_loodMore').attr("hasmore")==1){
                    $(this).find('img').addClass('loadRotate');
                    var index = $(this).attr('pageIndex');
                    var type = $('.case_nav .act').attr('type');
                    index++;
                    $(this).attr('pageIndex', index);
                    loadData($(this).attr('pageIndex'), type);
                }
            });
            function loadData(pageIndex, type) {
                $.request('/api/News/GetPagingList', {
                    pageIndex: pageIndex || 1,
                    pageSize: 10,
                    timestamp: ts(),
                    type: type,
                    sign: createSign({
                        "pageIndex": 1,
                        "pageSize": 10,
                        timestamp: ts(),
                        type: type
                    })
                },
                    function (res) {
                        if(res.data.newsList.length==0){
                            $('.case_loodMore').attr("hasmore","0");
                            $('.case_loodMore').find('img').removeClass('loadRotate');
                            $('.case_loodMore').find('p').html("没有更多了");
                            return;
                        }
                        var data = {
                            'list': res.data.newsList
                        };
                        // var data = res.data
                        var bt = baidu.template;
                        var html = bt('navTemplate', data);
                        console.log(html)
                        if ( $('.case_loodMore').attr("pageIndex")!=1) {
                            $('.news_cont').append(html);
                        } else {
                            $('.news_cont').html(html);
                        }

                        $('.case_loodMore').find('img').removeClass('loadRotate');
                    }
                );
            }
        });

    </script>
</body>

</html>